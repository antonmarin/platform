name: test restoring
on: # https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#push
  schedule:
    - cron: "15 */4 * * *"
  push: # uncomment to test
jobs:
  update-utils:
    name: Test restoring vaultwarden database
    runs-on: ubuntu-latest
    if: ${{ github.ref_name == 'master' }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4 # https://github.com/actions/checkout
      - name: restore
        run: make test-restore
        env:
          POSTGRES_USER: vaultwarden
          POSTGRES_PASSWORD: pass
          POSTGRES_DB: test
          GPG_PASSPHRASE: ${{ secrets.VW_BACKUP_PASSPHRASE }}
          BACKUP_PATH: ${{ secrets.VW_BACKUP_PATH }}
          RCLONE_CONFIG_REMOTE_ENDPOINT: ${{ secrets.VW_BACKUP_ENDPOINT }}
          RCLONE_CONFIG_REMOTE_ACCESS_KEY_ID: ${{ secrets.VW_BACKUP_KEY_ID }}
          RCLONE_CONFIG_REMOTE_SECRET_ACCESS_KEY: ${{ secrets.VW_BACKUP_SECRET }}
